<?xml version="1.0" encoding="utf-8"?>
<root xmlns:android="http://schemas.android.com/apk/res/android" 
      xmlns:tools="http://schemas.android.com/tools">

  <init>
    <setStringFromProperty 
      result="PackageName"
      ini="Engine"
      section="/Script/AndroidRuntimeSettings.AndroidRuntimeSettings" 
      property="PackageName" 
      default="" />

    <setStringFromProperty 
      result="FacebookAppID" 
      ini="Engine" 
      section="/Script/FirebaseAuthenticationEditor.FirebaseSettings" 
      property="FacebookAppID" 
      default="" />
  </init>

  <prebuildCopies>
    <copyFile 
      src="$S(PluginDir)/../../../../Build/Android/google-services.json" 
      dst="$S(BuildDir)/gradle/FirebaseAuthentication/google-services.json"/>

    <copyDir 
      src="$S(PluginDir)/ThirdParty/FirebaseAuthentication/"
      dst="$S(BuildDir)/JavaLibs/FirebaseAuthentication" />
  </prebuildCopies>
  
  <androidManifestUpdates>
    <addElements tag="application">
      <meta-data
        android:name="com.facebook.sdk.ApplicationId"
        android:value="@string/FacebookAppID"
        tools:replace="android:value" />

      <activity
        android:name="com.facebook.FacebookActivity"
        android:configChanges="keyboard|keyboardHidden|screenLayout|screenSize|orientation"
        android:label="@string/app_name"
        android:theme="@android:style/Theme.Translucent.NoTitleBar"
        tools:replace="android:theme" />
    </addElements>
    <addPermission android:name="android.permission.INTERNET" />
  </androidManifestUpdates>
  
	<AARImports>
    <replace find="play-services-auth,11.8.0"   with="play-services-auth,16.0.0"/>
    <replace find="play-services-games,11.8.0"  with="play-services-games,16.0.0"/>
    <replace find="play-services-nearby,11.8.0" with="play-services-nearby,16.0.0"/>
    <replace find="play-services-plus,11.8.0"   with="play-services-plus,16.0.0"/>
  </AARImports>

  <gradleProperties>
    <insertValue value="FACEBOOK_APP_ID=$S(FacebookAppID)" />
    <insertNewline/>
  </gradleProperties>

  <buildGradleAdditions>
    <insert>
      android 
      {
          buildTypes 
          {
			        buildTypes.each
				      {
				          it.signingConfig signingConfigs.release
                  it.resValue "string", "FacebookAppID", FACEBOOK_APP_ID
			        }
          }
      }
    </insert>
  </buildGradleAdditions>

  <buildscriptGradleAdditions>
    <insert>
      dependencies
      {
          classpath 'com.google.gms:google-services:4.0.0'
      }
    </insert>
  </buildscriptGradleAdditions>

</root>